"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),sparkLiner=function(){function t(e,i,o,s){switch(_classCallCheck(this,t),this._root=e,this._data=i,this._dataLen=this._data.length,this._type=o,this._defaults={showTooltips:!0,barSpace:2,dotRadius:4,dotVerticalLine:!0,lineShowCursor:!0,histogramBarCount:5,histogramBarSpace:2,progressGradientStart:"red",progressGradientEnd:"rgb(120, 141, 255)",progressGradientLineOverflow:10,progressStepLineOverflow:10},this._options=Object.assign({},this._defaults,s),this._computedStyle=getComputedStyle(this._root),this._rootWidth=this._root.clientWidth-parseInt(this._computedStyle.paddingLeft)-parseInt(this._computedStyle.paddingRight),this._rootHeight=this._root.clientHeight-parseInt(this._computedStyle.paddingTop)-parseInt(this._computedStyle.paddingBottom),this._type){case"bars":this._renderBars();break;case"dots":this._renderDots();break;case"polygon":this._renderPolygon();break;case"histogram":this._renderHistogram();break;case"progressgradient":this._renderProgressGradient();break;case"progressstep":this._renderProgressStep();break;case"progresscircle":this._renderProgressCircle();break;default:alert("Invalid type of chart")}this._activateTooltip()}return _createClass(t,[{key:"_activateTooltip",value:function(){var t=this;this._options.showTooltips&&!document.getElementById("sparkliner__tooltip")?(this._tooltip=document.createElement("div"),this._tooltip.id="sparkliner__tooltip",document.body.appendChild(this._tooltip),document.body.addEventListener("mousemove",function(e){t._tooltip.style.left=e.clientX+15+"px",t._tooltip.style.top=e.clientY+15+window.pageYOffset+"px"})):this._tooltip=document.getElementById("sparkliner__tooltip")}},{key:"_calculateIntersection",value:function(t,e,i){var o=(e[1]-t[1])/i;return t[0]+Math.abs(t[1]/o)}},{key:"_positionToValue",value:function(t,e,i){for(var o=0;o<e.length-1;o++)if(t>=e[o][0]&&t<=e[o+1][0]){var s=t-e[o][0],a=(e[o+1][1]-e[o][1])/(e[o+1][0]-e[o][0]);return((e[o][1]+s*a)/i).toFixed(2)}}},{key:"_renderBars",value:function(){var t=this,e=this._options.barSpace,i=(this._rootWidth-e*(this._dataLen-1))/this._dataLen,o=Math.max.apply(null,this._data),s=Math.min.apply(null,this._data),a=0;s<0&&(o+=Math.abs(s),a=Math.abs(s)/o*this._rootHeight);for(var r="",n=0;n<this._dataLen;n++){var l=this._data[n]/o*this._rootHeight;r+="<path "+(this._data[n]>0?'class="sparkliner__bar"':'class="sparkliner__bar sparkliner__bar--underzero"')+' data-bar-value="'+this._data[n]+'" d="M'+n*(i+e)+" "+(this._rootHeight-a)+" L"+n*(i+e)+" "+(this._rootHeight-l-a)+" L"+(n*(i+e)+i)+" "+(this._rootHeight-l-a)+" L"+(n*(i+e)+i)+" "+(this._rootHeight-a)+' Z" />'}var h='<svg class="sparkliner" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+r+"</svg>";this._root.innerHTML=h,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("path"==i.tagName){var o=i.getAttribute("data-bar-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}else t._tooltip.style.display="none"}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}},{key:"_renderDots",value:function(){var t=this,e=this._rootWidth/this._dataLen,i=Math.max.apply(null,this._data),o=this._options.dotRadius,s=Math.min.apply(null,this._data),a=0;s<0&&(i+=Math.abs(s),a=Math.abs(s)/i*this._rootHeight);for(var r="",n=0;n<this._dataLen;n++){var l=this._data[n]/i*this._rootHeight-o;l=l>0?l:l+2*o,r+='<g data-dot-value="'+this._data[n]+'">\n                <circle '+(this._data[n]>0?'class="sparkliner__dot"':'class="sparkliner__dot sparkliner__dot--underzero"')+' cx="'+(n*e+e/2)+'" cy="'+(this._rootHeight-l-a)+'" r="'+o+'" />\n                '+(this._options.dotVerticalLine?"<line "+(this._data[n]>0?'class="sparkliner__dotline"':'class="sparkliner__dotline sparkliner__dotline--underzero"')+' class="sparkliner__dotline" x1="'+(n*e+e/2)+'" y1="'+(this._rootHeight-l-a)+'" x2="'+(n*e+e/2)+'" y2="'+(this._rootHeight-a)+'" />':"")+"\n                </g>"}var h='<svg class="sparkliner" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+r+" "+(s<0?'<line class="sparkliner__horizontal-axe" x1="0" y1="'+(this._rootHeight-a)+'" x2="'+this._rootWidth+'" y2="'+(this._rootHeight-a)+'" />':"")+"</svg>";this._root.innerHTML=h,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("circle"!=i.tagName&&"line"!=i.tagName||"g"!=i.parentElement.tagName)t._tooltip.style.display="none";else{var o=i.parentElement.getAttribute("data-dot-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}},{key:"_renderPolygon",value:function(){var t=this,e=this._rootWidth/(this._dataLen-1),i=Math.max.apply(null,this._data),o=Math.min.apply(null,this._data),s=0;o<0&&(i+=Math.abs(o),s=Math.abs(o)/i*this._rootHeight);for(var a=this._rootHeight/i,r=this._data.map(function(o,s){return[s*e,o/i*t._rootHeight]}),n=[[0,0]],l=0;l<r.length;l++)r[l+1]?r[l][1]<0&&r[l+1][1]>0?(n.push(r[l]),n.push([this._calculateIntersection(r[l],r[l+1],e),0])):r[l][1]>0&&r[l+1][1]<0?(n.push(r[l]),n.push([this._calculateIntersection(r[l],r[l+1],e),0])):n.push(r[l]):n.push(r[l]);n.push([this._rootWidth,0]);for(var h=[],_=[],d=[],p=0;p<n.length;p++)0==p?d.push(n[p].join(",")):p==n.length?(d.push(n[p].join(",")),n[p][1]>0?h.push(d):n[p][1]<0?_.push(d):n[p-1][1]>0?h.push(d):n[p-1][1]<0&&_.push(d)):0==n[p][1]?(d.push(n[p].join(",")),n[p-1][1]>0?h.push(d):_.push(d),(d=[]).push(n[p].join(","))):d.push(n[p].join(","));h=h.map(function(e){return(e=e.map(function(e){return[e.split(",")[0],t._rootHeight-s-e.split(",")[1]].join(",")})).join(" ")}),_=_.map(function(e){return(e=e.map(function(e){return[e.split(",")[0],t._rootHeight-s-e.split(",")[1]].join(",")})).join(" ")});var u="",g="",c=!0,v=!1,y=void 0;try{for(var m,f=h[Symbol.iterator]();!(c=(m=f.next()).done);c=!0)u+='<polygon class="sparkliner__polygon-positive" points="'+m.value+'" />'}catch(t){v=!0,y=t}finally{try{!c&&f.return&&f.return()}finally{if(v)throw y}}var k=!0,b=!1,L=void 0;try{for(var x,H=_[Symbol.iterator]();!(k=(x=H.next()).done);k=!0)g+='<polygon class="sparkliner__polygon-negative" points="'+x.value+'" />'}catch(t){b=!0,L=t}finally{try{!k&&H.return&&H.return()}finally{if(b)throw L}}var w='\n            <svg class="sparkliner" height="'+this._rootHeight+'" width="'+this._rootWidth+'">\n                '+u+"\n                "+g+"\n                "+(this._options.lineShowCursor?'<line class="sparkliner__polygon-cursor" x1="0" y1="'+this._rootHeight+'" x2="0" y2="0" />':"")+"\n            </svg>\n        ";if(this._root.innerHTML=w,this._options.showTooltips){var M=this._root.firstElementChild.lastElementChild;this._root.firstElementChild.addEventListener("mousemove",function(e){var i=t._root.getBoundingClientRect().left,o=t._root.clientLeft,s=parseInt(getComputedStyle(t._root,null).getPropertyValue("padding-left")),n=e.pageX-i-o-s,l=t._positionToValue(n,r,a);t._tooltip.innerText=l,void 0!==l?(t._tooltip.style.display="block",t._options.lineShowCursor&&(M.style.display="block")):(t._tooltip.style.display="none",t._options.lineShowCursor&&(M.style.display="none")),t._options.lineShowCursor&&(M.setAttribute("x1",""+n),M.setAttribute("x2",""+n))}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none",M.style.display="none"})}}},{key:"_renderHistogram",value:function(){for(var t=this,e=this._options.histogramBarSpace,i=(this._rootWidth-e*(this._options.histogramBarCount-1))/this._options.histogramBarCount,o=Math.min.apply(null,this._data),s=(Math.max.apply(null,this._data)-Math.min.apply(null,this._data))/this._options.histogramBarCount,a=[],r=0;r<this._options.histogramBarCount;r++)!function(e){var i=e*s+o,r=i+s,n=t._data.filter(function(t){return t>=i&&t<=r}).length;a.push(n)}(r);for(var n=this._rootHeight/Math.max.apply(null,a),l="",r=0;r<this._options.histogramBarCount;r++){var h=a[r]*n;l+='<path class="sparkliner__histogram-bar" data-bar-value="('+(o+r*s).toFixed(1)+"-"+(s+o+r*s).toFixed(1)+"):"+a[r]+'" d="\n                M'+r*(i+e)+" "+this._rootHeight+" \n                L"+r*(i+e)+" "+(this._rootHeight-h)+" \n                L"+(r*(i+e)+i)+" "+(this._rootHeight-h)+" \n                L"+(r*(i+e)+i)+" "+this._rootHeight+' \n            Z" />'}var _='<svg class="sparkliner" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+l+"</svg>";this._root.innerHTML=_,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("path"==i.tagName){var o=i.getAttribute("data-bar-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}else t._tooltip.style.display="none"}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}},{key:"_renderProgressGradient",value:function(){var t=this,e=void 0,i=void 0;!Array.isArray(this._data)&&this._data<=100?(e=this._data,i=100):Array.isArray(this._data)&&2===this._dataLen&&this._data[0]<this._data[1]&&(e=this._data[0],i=this._data[1]);var o=e/i*this._rootWidth,s='\n        <line class="sparkliner__progressgradient-line" data-progress-value="'+e+" / "+i+'" x1="'+o+'" y1="'+(this._rootHeight+this._options.progressGradientLineOverflow)+'" x2="'+o+'" y2="'+-this._options.progressGradientLineOverflow+'" />\n        <text class="sparkliner__progressgradient-text" data-progress-value="'+e+" / "+i+'" x="'+this._rootWidth/2+'" y="'+this._rootHeight/2+'" text-anchor="middle" alignment-baseline="middle" dominant-baseline="middle" >'+(e/i*100).toFixed(2)+"%</text>\n        ",a='<svg class="sparkliner sparkliner__progressgradient" data-progress-value="'+e+" / "+i+'" style="overflow:visible" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+s+"</svg>";this._root.innerHTML=a,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("svg"==i.tagName||"line"==i.tagName||"text"==i.tagName){var o=i.getAttribute("data-progress-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}else t._tooltip.style.display="none"}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}},{key:"_renderProgressStep",value:function(){var t=this,e=void 0,i=void 0;!Array.isArray(this._data)&&this._data<=100?(e=this._data,i=100):Array.isArray(this._data)&&2===this._dataLen&&this._data[0]<this._data[1]&&(e=this._data[0],i=this._data[1]);var o=e/i*this._rootWidth,s='\n            <path class="sparkliner__progressstep-complete" data-progress-value="'+e+" / "+i+'" d="M0 0 L0 '+this._rootHeight+" L"+o+" "+this._rootHeight+" L"+o+' 0 Z" />\n            <path class="sparkliner__progressstep-incomplete" data-progress-value="'+e+" / "+i+'" d="M'+o+" 0 L"+o+" "+this._rootHeight+" L"+this._rootWidth+" "+this._rootHeight+" L"+this._rootWidth+' 0 Z" />\n            <line class="sparkliner__progressstep-line" data-progress-value="'+e+" / "+i+'" x1="'+o+'" y1="'+(this._rootHeight+this._options.progressStepLineOverflow)+'" x2="'+o+'" y2="'+-this._options.progressStepLineOverflow+'" />\n            <text class="sparkliner__progressstep-text" data-progress-value="'+e+" / "+i+'" x="'+this._rootWidth/2+'" y="'+this._rootHeight/2+'" text-anchor="middle" alignment-baseline="middle" dominant-baseline="middle" >'+(100*e/i).toFixed(2)+"%</text>\n        ",a='<svg class="sparkliner" style="overflow:visible" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+s+"</svg>";this._root.innerHTML=a,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("path"==i.tagName||"line"==i.tagName||"text"==i.tagName){var o=i.getAttribute("data-progress-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}else t._tooltip.style.display="none"}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}},{key:"_renderProgressCircle",value:function(){var t=this,e=this._rootHeight/2,i=void 0,o=void 0;!Array.isArray(this._data)&&this._data<=100?(i=100==this._data?i=99.9999:this._data,o=100):Array.isArray(this._data)&&2===this._dataLen&&this._data[0]<=this._data[1]&&(i=100==this._data[0]?i=99.9999:this._data[0],o=this._data[1]);var s=i/o*2*Math.PI,a=this._rootWidth/2+e,r=this._rootHeight/2,n=a+e*Math.cos(Math.PI/2-s),l=r+e*-Math.sin(Math.PI/2-s),h='\n            <text class="sparkliner__circle-text" data-circle-value="'+i+" / "+o+'" x="'+(this._rootWidth/2-3)+'" y="'+this._rootHeight/2+'" text-anchor="end" alignment-baseline="middle" dominant-baseline="middle">\n                '+(100*i/o).toFixed(1)+'%\n            </text>\n            <circle class="sparkliner__circle-incomplete" data-circle-value="'+i+" / "+o+'" cx="'+a+'" cy="'+r+'" r="'+e+'"/>\n            <path class="sparkliner__circle-complete" data-circle-value="'+i+" / "+o+'" \n                d="M'+a+",0\n                A"+e+","+e+" 0 "+(s<=Math.PI?"0,1":"1,1")+" "+n+","+l+" \n                L"+a+","+r+' \n                Z" \n            />\n        ',_='<svg class="sparkliner" style="overflow:block" height="'+this._rootHeight+'" width="'+this._rootWidth+'">'+h+"</svg>";this._root.innerHTML=_,this._options.showTooltips&&(this._root.addEventListener("mousemove",function(e){var i=e.target;if("path"==i.tagName||"circle"==i.tagName||"text"==i.tagName){var o=i.getAttribute("data-circle-value");t._tooltip.innerText=o,t._tooltip.style.display="block"}else t._tooltip.style.display="none"}),this._root.addEventListener("mouseleave",function(){t._tooltip.style.display="none"}))}}]),t}();